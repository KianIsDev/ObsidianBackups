#!/bin/bash
cd ~/Documents/Obsidian/ObsidianBackups

# gnome-terminal
# /usr/bin/flatpak run --branch=stable --arch=x86_64 --command=obsidian.sh --file-forwarding md.obsidian.Obsidian @@u %U @@
# /usr/bin/flatpak run --branch=stable --arch=x86_64 --command=obsidian.sh --file-forwarding md.obsidian.Obsidian @@u %U @@
# /usr/bin/flatpak run md.obsidian.Obsidian
echo "" >> obsidian.path

ob=$(cat obsidian.path);

if [ $ob == "" ];
then
	echo "where is it???????????????????????????????";
fi

echo $ob


rt=$(date '+%d');
gnome-terminal -x bash -c "echo \"$rt\" > running.running; /usr/bin/flatpak run --branch=stable --arch=x86_64 --command=obsidian.sh --file-forwarding md.obsidian.Obsidian @@u %U @@; echo \"-1\" > running.running"

st=$(cat running.running)
while [ $st -eq $rt ]
do
	git pull
	git add .
    
    rt=$(date '+%d');
	dt=$(date '+%d/%m/%Y %H:%M:%S');
	git commit -a -m "Backup $dt"
	git push
	echo "Backup $dt" >> BackupLog.running
	st=$(cat running.running)
	echo -e "\e[32mRunning SessionID\e[0m[$st] \e[32mExpected SessionID\e[0m[$rt]"
	sleep 10
done

if [ $st -ne "-1" ]; then
	gnome-terminal -x bash -c "echo -e \"\e[31mDAILY SESSION EXPIRED!\e[0m Close Obsidian and re-open the backup program to start a new session\"; exec bash"
else
	gnome-terminal -x bash -c "echo -e \"\e[32mClosing Backup-Tool\e[0m dont wait for this window to close... Just close it already!\"; sleep 5"
fi

echo "-1" > running.running
